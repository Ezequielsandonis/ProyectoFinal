


@using TucConnect.Models.Models.ViewModels
@model ChatViewModel

<div class="chat-container py-5">
    <div class="chat-view">
        <div id="chat-messages">
            @Html.Partial("~/Views/Shared/Partials/_MessagesPartial.cshtml", Model.Messages)
        </div>
        <form id="send-message-form" method="post" asp-action="SendMessage" asp-controller="Chat">
            <input type="hidden" id="ChannelUrl" name="ChannelUrl" value="@Model.ChannelUrl" />
            <textarea id="Message" name="Message" required></textarea>
            <button type="submit">Enviar</button>
        </form>
    </div>
</div>


@section Scripts {
 
    <script>
        $(document).ready(function () {
            var connection = new signalR.HubConnectionBuilder().withUrl("/chatHub").build();

            connection.start().then(function () {
                console.log("Conexión establecida con el servidor SignalR.");
            }).catch(function (err) {
                return console.error(err.toString());
            });

            connection.on("ReceiveMessage", function (user, message) {
                $('#chat-messages').append('<div><strong>' + user + ':</strong> ' + message + '</div>');
            });

            // Función para enviar mensajes
            $("#send-message-form").submit(function (event) {
                event.preventDefault(); // Evitar la acción de envío estándar

                var formData = $(this).serialize();

                $.ajax({
                    type: "POST",
                    url: "@Url.Action("SendMessage", "Chat")",
                    data: formData,
                    success: function (response) {
                        // Aquí puedes manejar la respuesta si es necesario
                    },
                    error: function () {
                        alert("Error al enviar el mensaje.");
                    }
                });

                // Limpiar el campo de mensaje después de enviar
                $("#Message").val("");
            });
        });
    </script>
}




<style>
    .chat-container {
        display: flex;
        height: 100%;
        border: 1px solid #ccc;
        border-radius: 5px;
        overflow: hidden;
        overflow-y: auto;
    }

    .chat-view {
        width: 100%;
        background-color: #f5f5f5; /* Cambio el color de fondo para una apariencia más suave */
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    #chat-messages {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
    }

    .message {
        margin-bottom: 10px;
        padding: 10px;
        border-radius: 10px;
        max-width: 70%;
        word-wrap: break-word; /* Permite romper palabras largas */
    }

    .current-user {
        align-self: flex-start;
        background-color: #DCF8C6; /* Color de fondo para mensajes del usuario actual */
        color: #333; /* Color de texto más oscuro para mejor legibilidad */
    }

    .other-user {
        align-self: flex-end;
        background-color: #E6E6E6; /* Color de fondo para mensajes de otros usuarios */
        color: #333; /* Color de texto más oscuro para mejor legibilidad */
    }

    .message-content {
        padding: 5px;
    }

    .timestamp {
        font-size: 0.8em;
        color: #888;
        margin-left: 10px;
    }

    .no-messages {
        text-align: center;
        margin-top: 20px;
        color: #888;
    }

    #send-message-form {
        display: flex;
        padding: 10px;
        border-top: 1px solid #ccc;
        background-color: #f9f9f9;
    }

    #send-message-form textarea {
        flex: 1;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        resize: none;
        margin-right: 10px;
        font-family: Arial, sans-serif; /* Asegura la consistencia en la fuente del texto */
        font-size: 14px; /* Tamaño de fuente ligeramente más grande para mejor legibilidad */
    }

    #send-message-form button {
        padding: 10px 20px;
        border: none;
        background-color: #4CAF50;
        color: white;
        cursor: pointer;
        border-radius: 5px;
        font-size: 14px; /* Tamaño de fuente ligeramente más grande para mejor legibilidad */
    }
</style>
